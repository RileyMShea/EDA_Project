---
title: "Red Wine Quality EDA by Riley Shea"
output:
  html_document: 
    highlight: pygments
editor_options:
  chunk_output_type: console
---
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# install.packages('GGally')
# install.packages('scales')
# install.packages('memisc')
# install.packages('lattice')
# install.packages('MASS')
# install.packages('car')
# install.packages('reshape')
# install.packages('plyr')
library(RColorBrewer)
library(grid)
library(gridExtra)
library(GGally)
library(scales)
library(memisc)
library(ggplot2)
library(knitr)
library(dplyr)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Load the Data
wine <- read.csv('winequalityreds.csv', sep = ',')
# drop line number column 'X'
wine <- select(wine,-c(X))
```

This report explores a dataset containing chemical attributes and quality
scores for approximately 1600 samples of red wine.

# Univariate Plots Section
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Dimensions of df
dim(wine)
# list the the structure of df
str(wine)
# some quick stats on the columns of df
summary(wine)
```

Our dataset consists of 12 variables with ~1600 observations.

The 'X' variable is merely the row number, so it was dropped after import.
The quality is a median of >= 3 expert's ratings

```{r echo=FALSE, message=FALSE, warning=FALSE}
wine$badfso <- factor(wine$free.sulfur.dioxide > 50)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(quality), data = wine) +
  geom_histogram(binwidth = 1, fill = '#5760AB') +
  ggtitle('Quality') +
  scale_x_continuous(breaks = seq(3, 8, 1), limits = c(2, 9))
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(quality), data = wine) +
  geom_histogram(binwidth = .08, fill = 'brown') +
  ggtitle('Quality log10') +
  scale_x_log10()
```

This dataset lacks categorical variables and the input variables are fairly
granular. Couple of noteworth exceptions

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(fixed.acidity), data = wine) +
  geom_histogram(binwidth = .1, fill = '#5760AB') +
  ggtitle('Fixed Acidity') +
  scale_x_continuous(breaks = seq(5, 15, 1), limits = c(5, 15))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(volatile.acidity), data = wine) +
  geom_histogram(binwidth = .05, fill = '#5760AB') +
  ggtitle('Fixed Acidity') +
  scale_x_continuous(breaks = seq(0.1, 1.3, .1), limits = c(.1, 1.3)) 
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(citric.acid), data = wine) +
  geom_histogram(binwidth = .01, fill = '#5760AB') +
  ggtitle('Citric Acid') +
  scale_x_continuous(breaks = seq(0.0, 0.8, .1), limits = c(-.1, .8)) 
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(residual.sugar), data = wine) +
  geom_histogram(binwidth = .05, fill = '#5760AB') +
  ggtitle('Residual Sugar') +
  scale_x_log10(breaks = seq(1, 8, 1), limits = c(1, 8)) 
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(chlorides), data = wine) +
  geom_histogram(binwidth = .01, fill = '#5760AB') +
  ggtitle('Chlorides') +
  scale_x_continuous(breaks = seq(0, .2, .02), limits = c(0.01, .2)) 
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(free.sulfur.dioxide), data = wine) +
  geom_histogram(binwidth = 1, fill = '#5760AB') +
  ggtitle('Free Sulfur Dioxide') +
  scale_x_continuous(breaks = seq(0, 50, 5), limits = c(0, 50)) 
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(total.sulfur.dioxide), data = wine) +
  geom_histogram(binwidth = 1, fill = '#5760AB') +
  ggtitle('Total Sulfur Dioxide') +
  scale_x_continuous(breaks = seq(0, 160, 10), limits = c(0, 160)) 
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(density), data = wine) +
  geom_histogram(binwidth = .001, fill = '#5760AB') +
  ggtitle('density') +
  scale_x_continuous(breaks = seq(0.990, 1.04, .002), limits = c(.990, 1.004)) 
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(pH), data = wine) +
  geom_histogram(binwidth = .1, fill = '#5760AB') +
  ggtitle('pH') +
  scale_x_continuous(breaks = seq(2.8, 3.8, .4), limits = c(2.8, 3.8)) 
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(sulphates), data = wine) +
  geom_histogram(binwidth = .05, fill = '#5760AB') +
  ggtitle('Sulphates') +
  scale_x_continuous(breaks = seq(.25, 1.25, .25), limits = c(.25, 1.25)) 
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(alcohol), data = wine) +
  geom_histogram(binwidth = .1, fill = '#5760AB') +
  ggtitle('Alcohol') + 
  scale_x_continuous(breaks = seq(9, 13, 1), limits = c(9, 13)) 
```

### What is the structure of your dataset?

There are 15,999 wine samples in the dataset with 12 features(fixed acidity,
volatile acidity, citric acid, residual sugar, chlorides, free sulfur dioxide,
total sulfur dioxide, density, pH, sulphates, alchohol, and quality).
Quality is an output variable of integer type.  The remaining 11 variables are
input variables of numeric type.

Other observations:

* There are much more normal wines than there are 'poor' or 'excellent' wines.
The vast majority range from 5-to-7
* The median quality is a 6, and the max quality score is an 8.
* All wines have a pH far below 7(~3-to-4), making their pH 'basic'.


### What is/are the main feature(s) of interest in your dataset?

From this dataset I am most interested in the 'quality' variable and how it 
interacts with:

* volatile acidity

> "volatile acidity: the amount of acetic acid in wine, which at too high of
levels can lead to an unpleasant, vinegar taste"

* citric acid

> "citric acid: found in small quantities, citric acid can add 'freshness'
and flavor to wines"

* free sulfur oxide

> "...at free SO2 concentrations  over 50 ppm, SO2 becomes evident in the
nose and taste of wine"
 

### What other features in the dataset do you think will help support your
### investigation into your feature(s) of interest?

The 'residual sugar' variable might also have been of interest since it is an
indicator of sweetness.  Seeing if there was a perceived quality difference for
sweet or dry red wines might have been interesting.
Unfortunately all the wines in the dataset fell far below the 45 g/L(dm^3), 
so all obervations were of dry wines.

### Did you create any new variables from existing variables in the dataset?

I would've liked to create some categorical variables for input variables
with thresholds that define a wine characteristic (sweet/dry, acidic/basic, 
) unfortunately the wine values weren't split between the two thresholds. 



### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?

Only tidying I did was to remove the 'X' field as it was redudant with R's own
row names.


# Bivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(wine, aes(volatile.acidity, quality)) +
  scale_x_continuous(lim = c(0, quantile(wine$volatile.acidity, 0.99))) +
  scale_y_continuous(lim = c(0, quantile(wine$quality, 0.99))) +
  geom_point(
  fill = I('#F79420'),
  color = I('black'),
  shape = 21
  )
```

It looks like there might be a pattern here with this geom_point graph but it's
a little hard to discern.  Lets try using quality as a factor and use that to
generate a boxplot instead.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(wine, aes(factor(quality), volatile.acidity, color = factor(quality))) +
  geom_boxplot(outlier.colour = "red") +
  stat_summary(fun.y = mean,
  geom = 'point',
  shape = 8)
  
```

This makes it much easier to see the pattern.  As quality rating increases both
the median and mean volatile acidity decreases. This is true for each rating
with the exception of quality rating 8 for which there was very little data.

```{r echo=FALSE, message=FALSE, warning=FALSE}
cor(wine$quality, wine$volatile.acidity)
```

This confirms the plot findings showing a medium-strength negative correlation
between quality and volatile acidity.


```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(wine, aes(factor(quality), citric.acid, color = factor(quality))) +
  geom_boxplot(outlier.colour = "red") +
  stat_summary(fun.y = mean,
               geom = 'point',
               shape = 8) 
```

Here we see another clear pattern.  In this case as citric acid increases the
factor increases too.

```{r echo=FALSE, message=FALSE, warning=FALSE}
cor(wine$quality, wine$citric.acid)
```

This seems to indicate a small positive correlation between citric acid and
quality

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(wine, aes(factor(quality), free.sulfur.dioxide,
                 color = factor(quality))) +
                 geom_boxplot(outlier.colour = "red") +
                 stat_summary(fun.y = mean,
                 geom = 'point',
                 shape = 8)
                 
```

This graph is perhaps the most interesting so far. Free sulphur dioxide seems
positively correlated with quality up until rank 5, at which point it trends
downward.  This seems to coincide with wineQualityInfo description which stated:

> "...at free SO2 concentrations over 50 ppm, SO2 becomes evident in the
nose and taste of wine"

However since the relation doesn't look linear the correlation coefficient may
not give us the full picture.

```{r echo=FALSE, message=FALSE, warning=FALSE}
cor(wine$quality, wine$free.sulfur.dioxide)
```

This is a case where the relationship coefficient seems to have failed us.

The quality attribute takes on so few values it effectively acts like an
ordered factor.  With that in mind we'll add a factor attribute based on quality
below.

```{r}
wine$fQuality <- factor(wine$quality)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# No need sample with a seed for this size of sample
ggpairs(
subset(
wine,
select = c(
"volatile.acidity",
"citric.acid",
"free.sulfur.dioxide",
"fQuality"
)
),
lower = list(continuous = wrap("points", shape = I('.'))),
upper = list(combo = wrap("box", outlier.shape = I('.'))),
axisLabels = 'internal'
)
```

```{r}
qplot(data = wine,  x = volatile.acidity) +
  facet_wrap( ~ fQuality)
```

Unfortuneately this faceted plot isn't very useful since the classes aren't
balanced.

# Bivariate Analysis

We saw three different types of relationships:

* medium-strength, negative linear between quality and volatile acidity
* low-strength, positive linear between quality and citric acid
* non-linear relationship between free sulfur oxide and quality

### Did you observe any interesting relationships between the other features 
### (not the main feature(s) of interest)?

From glancing over the ggpairs output it was interesting to note the
high-strength positive correlation between citric acid and fixed acidity,
in constrast to it's high strength negative correlation with volatile acidity.

### What was the strongest relationship you found?

The strongest relationship from the points of interest was volitile acidity
to quality.

From The entire dataset a high-strength negative correlation of -0.683 for 
'fixed acidity' and 'pH' seemed to be the strongest correlation I saw.

# Multivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE}


# install and load the RColorBrewer package
# library("RColorBrewer", lib.loc="~/Anaconda3/envs/py37pipped/Lib/R/library")

ggplot(aes(
x = volatile.acidity,
y = citric.acid,
colour = factor(quality)
), data = wine) +
geom_point(alpha = 1, size = 2) +
scale_color_brewer(type = 'div',
guide = guide_legend(
title = 'quality',
reverse = T,
override.aes = list(alpha = 1, size = 2)
)) +
scale_x_continuous(limits = c(0.15, 1.25),
breaks = seq(0.15, 1.5, .25)) +
scale_y_continuous(limits = c(-.1, .8),
breaks = seq(0, .8, .1)) +
ggtitle('citric.acid by volatile.acidity and quality')
```

Presumably, citric acid would account for some of the volatile acidity.
However their effect on quality is the opposite.  As seen in this scatterplot
their is a cluster of high quality samples with low volatile acidity and high
citric acid values.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(
  x = free.sulfur.dioxide,
  y = badfso,
  colour = factor(quality)
  ), data = wine) +
  # geom_point(alpha = .5, size = 5.5) +
  geom_point(
  aes(color = factor(quality)),
  stat = 'summary',
  fun.y = median,
  size = 5,
  alpha = .8
  ) +
  # scale_color_brewer(type = 'div',
  #   guide = guide_legend(title = 'Above 50ppm', reverse = T,
  #   override.aes = list(alpha = 1, size = 2))) +
  # scale_x_continuous( limits = c(0.15, 1.25),
  #    breaks = seq(0.15, 1.5, .25)) +
  # scale_y_continuous( limits = c(-.1, .8),
  #    breaks = seq(0, .8, .1)) +
  ggtitle('Free sulfur oxide > 50 ppm')
```

This confirms what we suspected earlier. The free sulfur oxide increases quality
up preserving freshness, however if the levels become too high it affects the
taste quality. None of the samples with free S02 over 50ppm achieved quality of
8.  

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(wine, aes(free.sulfur.dioxide, total.sulfur.dioxide)) +
  geom_point(aes(color = factor(quality)), stat = 'summary', fun.y = median) +
  scale_color_brewer(type = 'seq',
  guide = guide_legend(
  title = 'quality',
  reverse = T,
  override.aes = list(alpha = 1, size = 2)
  )) +
  scale_x_continuous(limits = c(1, 58),
  breaks = seq(1, 58, 10)) +
  scale_y_continuous(limits = c(5, 125),
  breaks = seq(5, 125, 10)) +
  ggtitle('free S02 by total S02 and quality')
```

Seem to see greater dispersion between samples as total S02 and free SO2
increase. At lower values they seem more tightly clustered together.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(
  x = free.sulfur.dioxide,
  y = citric.acid,
  colour = factor(quality)
  ),
  data = wine) +
  # geom_point(alpha = .5, size = 5.5) +
  geom_line(
  aes(color = factor(quality)),
  stat = 'summary',
  fun.y = median,
  size = 2,
  alpha = .8
  ) +
  scale_color_brewer(
  type = 'qual',
  guide = guide_legend(
  title = 'Above 50ppm',
  reverse = T,
  override.aes = list(alpha = 1, size = 2)
  )
  ) +
  # scale_x_continuous( limits = c(0.15, 1.25),
  #    breaks = seq(0.15, 1.5, .25)) +
  # scale_y_continuous( limits = c(-.1, .8),
  #    breaks = seq(0, .8, .1)) +
  ggtitle('citric acid by free SO2 and quality')
```
Not seeing a clear relationship between between these three variables.


# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the 
### investigation. Were there features that strengthened each other in terms of 
### looking at your feature(s) of interest?

The first plot in multi-variate analysis 
Presumably, citric acid would account for some of the volatile acidity.
However their effect on quality is the opposite.  As seen in this scatterplot
their is a cluster of high quality samples with low volatile acidity and high
citric acid values.

This confirms what we suspected earlier. The free sulfur oxide increases quality
up preserving freshness, however if the levels become too high it affects the
taste quality.  

### Were there any interesting or surprising interactions between features?

Had trouble finding notable multivariate interactions between our values of
interest.  Nothing surprising that went against the statements made in the
description of values provided in the dataset description.

### OPTIONAL: Did you create any models with your dataset? 

No models were created.

------

# Final Plots and Summary

Ultimately it seems the bivariate plots we created provided the most value.

### Plot One
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(wine, aes(factor(quality), volatile.acidity, color = factor(quality))) +
  geom_boxplot(outlier.colour = "red") +
  stat_summary(fun.y = mean,
  geom = 'point',
  shape = 8) 
```

### Description One


### Plot Two
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(wine, aes(factor(quality), citric.acid, color = factor(quality))) +
  geom_boxplot(outlier.colour = "red") +
  stat_summary(fun.y = mean,
  geom = 'point',
  shape = 8) +
  labs(
  title = "Citric Acid by Quality Boxplot",
  x = "Quality rating (score between 0 and 10)",
  y = "Citric acid (g / dm^3)",
  colour = "Quality"
  )
```

### Description Two


### Plot Three
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(wine, aes(factor(quality), free.sulfur.dioxide,
                 color = factor(quality))) +
                 geom_boxplot(outlier.colour = "red") +
                 stat_summary(fun.y = mean,
                 geom = 'point',
                 shape = 8) +
                 labs(
                 title = "Free Sulfur Oxide by Quality Boxplot",
                 x = "Quality rating (score between 0 and 10)",
                 y = "Free Sulfur Oxide (mg / dm^3)",
                 colour = "Quality"
                 )
```

### Description Three

------

# Reflection

Ultimately this dataset seemed to not be great for multivariate analysis. Had
the dataset contained info like grape types, wine brand, wine selling price, etc
I feel much more interesting analysis could've been done.  Regardless, we did
see some interesting bivariate relationships between our input variables of
interest and their effect on the output variable of Quality.

If I were to do further analyis I'd try to wrangle a bigger set, with some of
the afformentioned attributes.  Then we could draw some conclusions between
